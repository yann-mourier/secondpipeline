pipeline {
  agent any
  
  stages {
    stage('construction') {
      stage('construction1') {
       steps {
          echo "etape de construction : initialisation"
          sh 'make main'
          sh 'ls'
          archiveArtifacts artifacts: 'main', fingerprint: true
        }
      }
     stage(construction2) {
        when {
         changelog '.* production .*'
         }
       steps {
          echo "etape de construction : finalisation"
          sh 'strip main'
        }
      }
   }
  
  stage('test') {
      steps {
        echo "etape de test"
        sh 'ls'
       /* junit '*.xml' */
      }
    }

    stage('deploiement') {
      steps {
        echo 'etape de deploiement'
      }
      when {
        changelog '.* deploy .*'
      }
    }
  }
}