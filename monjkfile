pipeline {
  agent any
  
  stages {
 
    stage('build') {
      steps {
        echo "etape de test"
        sh 'tree /tmp'
      }
    }
    stage('build avec variable dynamique') {
      environment {
        CC = """${sh(
                returnStdout: true,
                script: 'echo "clang"'
            )}""" 
        // Using returnStatus
        EXIT_STATUS = """${sh(
                returnStatus: true,
                script: 'exit 1'
            )}"""
        }
      steps {
        echo "etape de build avec variable dynamique"
        sh 'printenv'
      }
    }
  }
}